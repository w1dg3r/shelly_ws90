<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="/homey.js" data-origin="pair"></script>
    </head>
    <body class="homey-pair-view">
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 20px; text-align: center;">
            <div id="status">
                <p>Ready to add WS90 Weather Station.</p>
                <p style="font-size: 0.9em; color: #666;">Ensure MQTT is configured in App Settings.</p>
            </div>
            
            <button class="homey-button-primary-full" id="add_btn" onclick="addDevice()">Add Device</button>
            <p id="error" style="color: red; margin-top: 10px;"></p>
        </div>

        <script>
            function addDevice() {
                const btn = document.getElementById('add_btn');
                const status = document.getElementById('status');
                const errEl = document.getElementById('error');
                
                btn.disabled = true;
                btn.innerText = "Adding...";
                errEl.innerText = "";
                
                // Add the device
                Homey.addDevice({
                    name: 'WS90 Weather Station',
                    data: {
                        id: 'ws90_device'
                    }
                }, (err) => {
                    if (err) {
                        btn.disabled = false;
                        btn.innerText = "Retry";
                        errEl.innerText = err.message || err;
                        return;
                    }
                    
                    // Success
                    status.innerHTML = "<p>Device Added Successfully!</p>";
                    btn.style.display = 'none';
                    
                    // Close the wizard
                    Homey.done();
                });
            }
            
            Homey.setTitle('Add WS90');
        </script>
    </body>
</html>
